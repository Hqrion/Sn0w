//Deobfuscated with https://github.com/PetoPetko/Minecraft-Deobfuscator3000 using mappings "1.12 stable mappings"!

/*
 * Decompiled with CFR 0.151.
 * 
 * Could not load the following classes:
 *  net.minecraft.block.Block
 *  net.minecraft.block.state.IBlockState
 *  net.minecraft.init.Blocks
 *  net.minecraft.network.Packet
 *  net.minecraft.network.play.client.CPacketPlayer$Rotation
 *  net.minecraft.network.play.client.CPacketPlayerDigging
 *  net.minecraft.network.play.client.CPacketPlayerDigging$Action
 *  net.minecraft.util.EnumHand
 *  net.minecraft.util.math.BlockPos
 *  net.minecraft.util.math.MathHelper
 *  net.minecraft.util.math.Vec3d
 *  net.minecraft.world.World
 */
package me.zeroeightsix.kami.module.modules.exploits;

import java.awt.Color;
import java.util.function.Predicate;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import me.zeroeightsix.kami.KamiMod;
import me.zeroeightsix.kami.event.events.DamageBlockEvent;
import me.zeroeightsix.kami.event.events.RenderEvent;
import me.zeroeightsix.kami.module.Module;
import me.zeroeightsix.kami.setting.Setting;
import me.zeroeightsix.kami.setting.Settings;
import me.zeroeightsix.kami.util.KamiTessellator;
import net.minecraft.block.Block;
import net.minecraft.block.state.IBlockState;
import net.minecraft.init.Blocks;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.network.play.client.CPacketPlayerDigging;
import net.minecraft.util.EnumHand;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.MathHelper;
import net.minecraft.util.math.Vec3d;
import net.minecraft.world.World;

@Module.Info(name="Packet Mine", category=Module.Category.EXPLOITS)
public class PacketMine
extends Module {
    private Setting<Integer> red;
    private Setting<Integer> green;
    private Setting<Integer> blue;
    private Setting<Integer> redB;
    private Setting<Integer> greenB;
    private Setting<Integer> blueB;
    private Setting<Integer> Alpha;
    private Setting<Integer> AlphaB;
    BlockPos gamer;
    @EventHandler
    private Listener<DamageBlockEvent> Hacker = new Listener<DamageBlockEvent>(event -> {
        if (this.canBreak(event.getPos())) {
            this.gamer = event.getPos();
            if (PacketMine.mc.world == null || PacketMine.mc.player == null) {
                return;
            }
            PacketMine.mc.player.swingArm(EnumHand.MAIN_HAND);
            PacketMine.mc.player.connection.sendPacket((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.START_DESTROY_BLOCK, event.getPos(), event.getFace()));
            PacketMine.mc.player.connection.sendPacket((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.STOP_DESTROY_BLOCK, event.getPos(), event.getFace()));
            event.cancel();
        }
    }, new Predicate[0]);

    public PacketMine() {
        this.Alpha = this.register(Settings.integerBuilder("Alpha").withRange(0, 255).withValue(0).build());
        this.AlphaB = this.register(Settings.integerBuilder("AlphaBorder").withRange(0, 255).withValue(0).build());
        this.red = this.register(Settings.integerBuilder("Red").withRange(0, 255).withValue(143).build());
        this.green = this.register(Settings.integerBuilder("Green").withRange(0, 255).withValue(0).build());
        this.blue = this.register(Settings.integerBuilder("Blue").withRange(0, 255).withValue(255).build());
        this.redB = this.register(Settings.integerBuilder("RedBorder").withRange(0, 255).withValue(143).build());
        this.greenB = this.register(Settings.integerBuilder("GreenBorder").withRange(0, 255).withValue(0).build());
        this.blueB = this.register(Settings.integerBuilder("BlueBorder").withRange(0, 255).withValue(255).build());
    }

    @Override
    public void onWorldRender(RenderEvent event) {
        if (this.gamer != null) {
            float[] hue = new float[]{(float)(System.currentTimeMillis() % 11520L) / 11520.0f};
            int rgb = Color.HSBtoRGB(hue[0], 1.0f, 1.0f);
            int r = rgb >> 16 & 0xFF;
            int g = rgb >> 8 & 0xFF;
            int b = rgb & 0xFF;
            KamiTessellator.prepare(7);
            KamiTessellator.drawBox(this.gamer, (int)this.red.getValue(), (int)this.green.getValue(), (int)this.blue.getValue(), (int)this.Alpha.getValue(), 63);
            KamiTessellator.release();
            KamiTessellator.prepare(7);
            KamiTessellator.drawBoundingBoxBlockPos(this.gamer, 1.0f, this.redB.getValue(), this.greenB.getValue(), this.blueB.getValue(), this.AlphaB.getValue());
            KamiTessellator.release();
        }
    }

    private boolean canBreak(BlockPos pos) {
        IBlockState blockState = PacketMine.mc.world.getBlockState(pos);
        Block block = blockState.getBlock();
        return block.getBlockHardness(blockState, (World)PacketMine.mc.world, pos) != -1.0f;
    }

    @Override
    protected void onEnable() {
        KamiMod.EVENT_BUS.subscribe((Object)this);
    }

    @Override
    public void onUpdate() {
        if (this.gamer != null && this.getBlock(this.gamer) == Blocks.AIR) {
            this.gamer = null;
        }
    }

    public static void faceVectorPacketInstant(Vec3d vec) {
        float[] rotations = PacketMine.getNeededRotations2(vec);
        PacketMine.mc.player.connection.sendPacket((Packet)new CPacketPlayer.Rotation(rotations[0], rotations[1], PacketMine.mc.player.onGround));
    }

    private static float[] getNeededRotations2(Vec3d vec) {
        Vec3d eyesPos = PacketMine.getEyesPos();
        double diffX = vec.x - eyesPos.x;
        double diffY = vec.y - eyesPos.y;
        double diffZ = vec.z - eyesPos.z;
        double diffXZ = Math.sqrt(diffX * diffX + diffZ * diffZ);
        float yaw = (float)Math.toDegrees(Math.atan2(diffZ, diffX)) - 90.0f;
        float pitch = (float)(-Math.toDegrees(Math.atan2(diffY, diffXZ)));
        return new float[]{PacketMine.mc.player.rotationYaw + MathHelper.wrapDegrees((float)(yaw - PacketMine.mc.player.rotationYaw)), PacketMine.mc.player.rotationPitch + MathHelper.wrapDegrees((float)(pitch - PacketMine.mc.player.rotationPitch))};
    }

    public static Vec3d getEyesPos() {
        return new Vec3d(PacketMine.mc.player.posX, PacketMine.mc.player.posY + (double)PacketMine.mc.player.getEyeHeight(), PacketMine.mc.player.posZ);
    }

    @Override
    protected void onDisable() {
        KamiMod.EVENT_BUS.unsubscribe((Object)this);
    }

    private Block getBlock(BlockPos pos) {
        IBlockState ibs = PacketMine.mc.world.getBlockState(pos);
        Block block = ibs.getBlock();
        return block;
    }
}

